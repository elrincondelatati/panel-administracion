<!DOCTYPE html>
<html lang="es">
<head>

 <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="manifest.json">

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üîê Admin - El Rinc√≥n de la Tati</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #FFEDE3 0%, #FFD6BA 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    h1 {
      color: #B22222;
      font-size: 1.8em;
    }

    .btn-logout {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      transition: 0.3s;
    }

    .btn-logout:hover {
      background-color: #c0392b;
    }

    /* Secci√≥n de Login */
    #loginSection {
      max-width: 400px;
      margin: 100px auto;
      background: white;
      padding: 40px;
      border-radius: 15px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    #loginSection h2 {
      color: #B22222;
      margin-bottom: 30px;
      text-align: center;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      color: #5A1E1E;
      font-weight: bold;
      margin-bottom: 8px;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 2px solid #d4af37;
      border-radius: 8px;
      font-size: 1em;
      outline: none;
      transition: 0.3s;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      border-color: #B22222;
      box-shadow: 0 0 8px rgba(178, 34, 34, 0.3);
    }

    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }

    .btn-primary {
      background-color: #27ae60;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      width: 100%;
      transition: 0.3s;
      font-weight: bold;
    }

    .btn-primary:hover {
      background-color: #229954;
    }

    .btn-add {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 1.1em;
      margin-bottom: 20px;
      transition: 0.3s;
      font-weight: bold;
    }

    .btn-add:hover {
      background-color: #2980b9;
    }

    /* Lista de Productos */
    .productos-lista {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .producto-card {
      background: white;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }

    .producto-card:hover {
      transform: translateY(-5px);
    }

    .producto-card img {
      width: 100%;
      height: 200px;
      object-fit: contain;
      border-radius: 8px;
      background-color: #f9f9f9;
      margin-bottom: 10px;
    }

    .producto-card h3 {
      color: #5A1E1E;
      font-size: 1.1em;
      margin-bottom: 10px;
    }

    .producto-card .precio {
      color: #B22222;
      font-size: 1.3em;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .producto-card .descripcion {
      color: #666;
      font-size: 0.9em;
      margin-bottom: 15px;
      line-height: 1.4;
    }

    .producto-actions {
      display: flex;
      gap: 10px;
    }

    .btn-edit {
      flex: 1;
      background-color: #f39c12;
      color: white;
      border: none;
      padding: 8px;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
    }

    .btn-edit:hover {
      background-color: #e67e22;
    }

    .btn-delete {
      flex: 1;
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 8px;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
    }

    .btn-delete:hover {
      background-color: #c0392b;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.6);
      z-index: 1000;
      overflow-y: auto;
      padding: 20px;
    }

    .modal-content {
      background: white;
      max-width: 600px;
      margin: 50px auto;
      padding: 30px;
      border-radius: 15px;
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 28px;
      font-weight: bold;
      color: #999;
      cursor: pointer;
      background: none;
      border: none;
    }

    .modal-close:hover {
      color: #333;
    }

    .modal h2 {
      color: #B22222;
      margin-bottom: 25px;
    }

    .hidden {
      display: none !important;
    }

    .alert {
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
      font-weight: bold;
    }

    .alert-error {
      background-color: #ffebee;
      color: #c62828;
      border: 2px solid #ef5350;
    }

    .alert-success {
      background-color: #e8f5e9;
      color: #2e7d32;
      border: 2px solid #66bb6a;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #B22222;
      font-size: 1.2em;
    }

    @media (max-width: 600px) {
      .productos-lista {
        grid-template-columns: 1fr;
      }

      header {
        flex-direction: column;
        text-align: center;
      }

      h1 {
        font-size: 1.4em;
      }
    }

    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
      width: 100%;
    }

    .file-input-wrapper input[type=file] {
      position: absolute;
      left: -9999px;
    }

    .file-input-label {
      display: block;
      padding: 12px;
      background-color: #f0f0f0;
      border: 2px dashed #d4af37;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: 0.3s;
    }

    .file-input-label:hover {
      background-color: #e8e8e8;
      border-color: #B22222;
    }

    .image-preview {
      margin-top: 15px;
      text-align: center;
    }

    .image-preview img {
      max-width: 100%;
      max-height: 200px;
      border-radius: 8px;
      border: 2px solid #d4af37;
    }
  </style>
</head>
<body>

  <!-- Secci√≥n de Login -->
  <div id="loginSection">
    <h2>üîê Acceso Administrador</h2>
    <div id="loginAlert"></div>
    <form id="loginForm">
      <div class="form-group">
        <label>Email:</label>
        <input type="email" id="loginEmail" required placeholder="tu@email.com">
      </div>
      <div class="form-group">
        <label>Contrase√±a:</label>
        <input type="password" id="loginPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
      </div>
      <button type="submit" class="btn-primary">Iniciar Sesi√≥n</button>
    </form>
  </div>

  <!-- Panel de Administraci√≥n -->
  <div id="adminPanel" class="hidden">
    <div class="container">
      <header>
        <div>
          <h1>üéÅ Panel de Administraci√≥n</h1>
          <p style="color: #666; margin-top: 5px;">Gestiona tu cat√°logo de productos</p>
        </div>
        <button class="btn-logout" onclick="cerrarSesion()">Cerrar Sesi√≥n</button>
      </header>

      <button class="btn-add" onclick="abrirModalAgregar()">‚ûï Agregar Nuevo Producto</button>

      <div id="loadingProductos" class="loading">Cargando productos...</div>
      <div id="productosLista" class="productos-lista"></div>
    </div>
  </div>

  <!-- Modal para Agregar/Editar Producto -->
  <div id="productoModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="cerrarModal()">&times;</button>
      <h2 id="modalTitulo">Agregar Producto</h2>
      <div id="modalAlert"></div>
      <form id="productoForm">
        <input type="hidden" id="productoId">
        
        <div class="form-group">
          <label>Nombre del Producto:</label>
          <input type="text" id="productoNombre" required placeholder="Ej: Pie de √°rbol rojo">
        </div>

        <div class="form-group">
          <label>Precio:</label>
          <input type="number" id="productoPrecio" required placeholder="5000" min="0">
        </div>

        <div class="form-group">
          <label>Descripci√≥n:</label>
          <textarea id="productoDescripcion" placeholder="Describe el producto..."></textarea>
        </div>

        <div class="form-group">
          <label>URL de la Imagen:</label>
          <input type="url" id="productoImagen" required placeholder="https://...">
          <small style="color: #666; display: block; margin-top: 5px;">
            Pega aqu√≠ el enlace de la imagen (debe ser de Dropbox, Google Drive, etc.)
          </small>
        </div>

        <div class="image-preview" id="imagePreview"></div>

        <button type="submit" class="btn-primary" style="margin-top: 20px;">Guardar Producto</button>
      </form>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, orderBy, query } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    // ‚ö†Ô∏è IMPORTANTE: Reemplaza esto con tu configuraci√≥n de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyB8Ys9IRyZIGz0mTukChadzTrH5hT5L2Ew",
      authDomain: "elrincondelatati-5cb0d.firebaseapp.com",
      projectId: "elrincondelatati-5cb0d",
      storageBucket: "elrincondelatati-5cb0d.firebasestorage.app",
      messagingSenderId: "817458607803",
      appId: "1:817458607803:web:8031e8002c9b1f6433db9e",
      measurementId: "G-S7VN7R5G94"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let currentUser = null;
    let editandoId = null;

    // Verificar estado de autenticaci√≥n
    onAuthStateChanged(auth, (user) => {
      if (user) {
        currentUser = user;
        mostrarPanelAdmin();
        cargarProductos();
      } else {
        currentUser = null;
        mostrarLogin();
      }
    });

    // Login
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      
      try {
        await signInWithEmailAndPassword(auth, email, password);
        mostrarAlerta('loginAlert', 'Iniciando sesi√≥n...', 'success');
      } catch (error) {
        mostrarAlerta('loginAlert', 'Error: Email o contrase√±a incorrectos', 'error');
      }
    });

    // Cerrar sesi√≥n
    window.cerrarSesion = async () => {
      try {
        await signOut(auth);
      } catch (error) {
        console.error('Error al cerrar sesi√≥n:', error);
      }
    };

    // Cargar productos
    async function cargarProductos() {
      const lista = document.getElementById('productosLista');
      const loading = document.getElementById('loadingProductos');
      
      try {
        loading.classList.remove('hidden');
        lista.innerHTML = '';

        const q = query(collection(db, 'productos'), orderBy('nombre'));
        const querySnapshot = await getDocs(q);

        if (querySnapshot.empty) {
          lista.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">No hay productos a√∫n. ¬°Agrega el primero!</p>';
        } else {
          querySnapshot.forEach((doc) => {
            const producto = doc.data();
            lista.innerHTML += crearCardProducto(doc.id, producto);
          });
        }
      } catch (error) {
        console.error('Error al cargar productos:', error);
        lista.innerHTML = '<p style="text-align: center; color: red; padding: 40px;">Error al cargar productos</p>';
      } finally {
        loading.classList.add('hidden');
      }
    }

    // Crear card de producto
    function crearCardProducto(id, producto) {
      const precio = formatearPrecio(producto.precio);
      return `
        <div class="producto-card">
          <img src="${producto.imagen}" alt="${producto.nombre}" onerror="this.src='https://via.placeholder.com/200?text=Sin+Imagen'">
          <h3>${producto.nombre}</h3>
          <p class="precio">$${precio}</p>
          <p class="descripcion">${producto.descripcion || 'Sin descripci√≥n'}</p>
          <div class="producto-actions">
            <button class="btn-edit" onclick="editarProducto('${id}')">‚úèÔ∏è Editar</button>
            <button class="btn-delete" onclick="eliminarProducto('${id}', '${producto.nombre}')">üóëÔ∏è Eliminar</button>
          </div>
        </div>
      `;
    }

    // Formatear precio
    function formatearPrecio(numero) {
      return numero.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    // Abrir modal para agregar
    window.abrirModalAgregar = () => {
      editandoId = null;
      document.getElementById('modalTitulo').textContent = 'Agregar Producto';
      document.getElementById('productoForm').reset();
      document.getElementById('imagePreview').innerHTML = '';
      document.getElementById('modalAlert').innerHTML = '';
      document.getElementById('productoModal').style.display = 'block';
    };

    // Editar producto
    window.editarProducto = async (id) => {
      editandoId = id;
      document.getElementById('modalTitulo').textContent = 'Editar Producto';
      document.getElementById('modalAlert').innerHTML = '';
      
      try {
        const docRef = doc(db, 'productos', id);
        const docSnap = await getDocs(collection(db, 'productos'));
        
        let productoData = null;
        docSnap.forEach((doc) => {
          if (doc.id === id) {
            productoData = doc.data();
          }
        });

        if (productoData) {
          document.getElementById('productoNombre').value = productoData.nombre;
          document.getElementById('productoPrecio').value = productoData.precio;
          document.getElementById('productoDescripcion').value = productoData.descripcion || '';
          document.getElementById('productoImagen').value = productoData.imagen;
          
          if (productoData.imagen) {
            document.getElementById('imagePreview').innerHTML = `<img src="${productoData.imagen}" alt="Preview">`;
          }
          
          document.getElementById('productoModal').style.display = 'block';
        }
      } catch (error) {
        alert('Error al cargar producto');
        console.error(error);
      }
    };

    // Eliminar producto
    window.eliminarProducto = async (id, nombre) => {
      if (confirm(`¬øEst√°s segura de eliminar "${nombre}"?`)) {
        try {
          await deleteDoc(doc(db, 'productos', id));
          mostrarAlerta('modalAlert', 'Producto eliminado correctamente', 'success');
          cargarProductos();
        } catch (error) {
          alert('Error al eliminar producto');
          console.error(error);
        }
      }
    };

    // Guardar producto (agregar o editar)
    document.getElementById('productoForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const nombre = document.getElementById('productoNombre').value;
      const precio = parseInt(document.getElementById('productoPrecio').value);
      const descripcion = document.getElementById('productoDescripcion').value;
      const imagen = document.getElementById('productoImagen').value;

      const productoData = {
        nombre,
        precio,
        descripcion,
        imagen,
        fechaActualizacion: new Date().toISOString()
      };

      try {
        if (editandoId) {
          // Actualizar producto existente
          await updateDoc(doc(db, 'productos', editandoId), productoData);
          mostrarAlerta('modalAlert', 'Producto actualizado correctamente', 'success');
        } else {
          // Agregar nuevo producto
          await addDoc(collection(db, 'productos'), productoData);
          mostrarAlerta('modalAlert', 'Producto agregado correctamente', 'success');
        }
        
        setTimeout(() => {
          cerrarModal();
          cargarProductos();
        }, 1500);
      } catch (error) {
        mostrarAlerta('modalAlert', 'Error al guardar producto', 'error');
        console.error(error);
      }
    });

    // Preview de imagen
    document.getElementById('productoImagen').addEventListener('input', (e) => {
      const url = e.target.value;
      const preview = document.getElementById('imagePreview');
      
      if (url) {
        preview.innerHTML = `<img src="${url}" alt="Preview" onerror="this.src='https://via.placeholder.com/200?text=URL+inv√°lida'">`;
      } else {
        preview.innerHTML = '';
      }
    });

    // Cerrar modal
    window.cerrarModal = () => {
      document.getElementById('productoModal').style.display = 'none';
      document.getElementById('productoForm').reset();
      editandoId = null;
    };

    // Mostrar alertas
    function mostrarAlerta(elementId, mensaje, tipo) {
      const alertClass = tipo === 'error' ? 'alert-error' : 'alert-success';
      document.getElementById(elementId).innerHTML = `<div class="alert ${alertClass}">${mensaje}</div>`;
    }

    // Mostrar/ocultar secciones
    function mostrarLogin() {
      document.getElementById('loginSection').classList.remove('hidden');
      document.getElementById('adminPanel').classList.add('hidden');
    }

    function mostrarPanelAdmin() {
      document.getElementById('loginSection').classList.add('hidden');
      document.getElementById('adminPanel').classList.remove('hidden');
    }

    // Hacer disponibles las funciones globalmente
    window.cargarProductos = cargarProductos;
  </script>

// -----------------------------------------
<script>
// C√≥digo para instalar como app
let deferredPrompt;
const installBtn = document.createElement('button');

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  
  // Crear bot√≥n de instalaci√≥n
  installBtn.textContent = 'üì± Instalar App';
  installBtn.style.cssText = `
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 10px 15px;
    background: #3367D6;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    z-index: 1000;
  `;
  
  installBtn.onclick = async () => {
    if (deferredPrompt) {
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      if (outcome === 'accepted') {
        installBtn.style.display = 'none';
      }
      deferredPrompt = null;
    }
  };
  
  document.body.appendChild(installBtn);
});

// Registrar Service Worker
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js')
    .then(() => console.log('Service Worker registrado'))
    .catch(err => console.log('Error SW:', err));
}
</script>
//-----------------------------------------

</body>
</html>